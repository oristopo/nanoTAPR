<!DOCTYPE html>
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
<title>TAPR VNA Software for nanoVNA</title>
<style>
body {
   margin-left: 60px;
   margin-right: 60px;
   margin-top: 400px;
}
th,td {
   text-align:left;
   padding-left: 15px;
}
</style>
</head>
  <body>
      
<h2 align=center id="tapr-vna-software">TAPR VNA Software</h2>
<h2 align=center id="instruction-manual">Instruction Manual</h2>

<p align=center ><img src="image1.png" alt=""><br>
<br>
preliminary for nanoVNA release 0.2.3 and VNAR4.4<br>
October 10, 2019</p>
<p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p><p> &nbsp </p>
<p><a href="https://www.tapr.org/~n5eg/index_files/vna_library/">Previous versions</a> for <a href="https://www.eham.net/reviews/detail/5436">Ten-Tec VNA</p>

<div style="page-break-after: always;"></div>

<font size=+1>
<p><strong>Table of Contents</strong></p>

<ol>
  <li><a href="#overview">Overview</a>
    <ol>
      <li><a href="#hardware-version-differences">Hardware Version Differences</a></li>
      <li><a href="#instrument-caution">Instrument Caution</a></li>
      <li><a href="#temperature-limitation">Temperature Limitation</a></li>
      <li><a href="#basic-performance">Basic Performance</a></li>
      <li><a href="#relative-measurements">Relative Measurements</a></li>
      <li><a href="#instrument-limitations">Instrument Limitations</a></li>
      <li><a href="#calibration-standards">Calibration Standards</a></li>
      <li><a href="#calibration-modes-are-single-threaded">Calibration Modes are Single-threaded</a></li>
    </ol>
  </li>
  <li><a href="#software-installation">Software Installation</a>
    <ol>
      <li><a href="#initial-software-installation">Initial Software installation</a></li>
      <li><a href="#hibernation-or-suspension-of-host-computer">PC Hibernation / Suspension</a></li>
      <li><a href="#supported-windows-versions">Supported Windows Versions</a></li>
      <li><a href="#software-distribution">Software Distribution</a></li>
      <li><a href="#installed-tapr-files">Installed TAPR Files</a></li>
      <li><a href="#installation-pre-requisites">Installation Pre-Requisites</a></li>
      <li><a href="#connecting-nanovna-to-your-computer">Connecting nanoVNA to your Computer</a></li>
      <li><a href="#uninstall">Uninstall</a></li>
    </ol>
  </li>
  <li><a href="#fixture-calibration">Fixture Calibration</a>
    <ol>
      <li><a href="#fixture-calibration-data">Fixture Calibration Data</a></li>
      <li><a href="#partial-changes-to-fixture-calibration-data">Partial Changes to Fixture Calibration Data</a></li>
      <li><a href="#fixture-setup-diagrams">Fixture Setup Diagrams</a></li>
      <li><a href="#actual-measurement">Actual measurement</a></li>
      <li><a href="#fixture-calibration-setups">Fixture Calibration Setups</a></li>
      <li><a href="#short-fixture-calibration">Short Fixture Calibration</a></li>
      <li><a href="#open-fixture-calibration">Open Fixture Calibration</a></li>
      <li><a href="#ohm-terminated-fixture-calibration">50-ohm Terminated Fixture Calibration</a></li>
      <li><a href="#through-fixture-calibration">Through Fixture Calibration</a></li>
    </ol>
  </li>
  <li><a href="#vna-software-menu">TAPR Software Menu</a>
    <ol>
      <li><a href="#file-menu">File Menu</a><br>
a.  <a href="#exporting-s-parameters">Exporting S-Parameters</a></li>
      <li><a href="#view-menu">View Menu</a></li>
      <li><a href="#calibration-menu">Calibration Menu</a></li>
      <li><a href="#trace-menu">Trace Menu</a><br>
      <li><a href="#device-under-test">Device Under Test</a></li>
      <li><a href="#vertical-scale-menu">Vertical Scale Menu</a></li>
      <li><a href="#marker-menu">Marker Menu</a></li>
      <li><a href="#frequency-grid-menu">Frequency Grid Menu</a></li>
      <li><a href="#storage-menu">Storage Menu</a></li>
      <li><a href="#integration-menu">Integration Menu</a></li>
      <li><a href="#help-software-updates">Help &amp; Software Updates</a></li>
    </ol>
  </li>
  <li><a href="#controls">Controls</a>
    <ol>
      <li><a href="#frequency-controls">Frequency Controls</a></li>
      <li><a href="#apply-calibration">Apply Calibration</a></li>
      <li><a href="#level-controls">Level Controls</a></li>
      <li><a href="#sweep-controls">Sweep Controls</a></li>
      <li><a href="#mouse-actions">Mouse Actions</a></li>
    </ol>
  </li>
  <li><a href="#example-measurement">Example Measurement</a>
    <ol>
      <li><a href="#some-cautions">Some Cautions</a></li>
      <li><a href="#common-display-results">Common Display Results</a></li>
    </ol>
  </li>
  <li><a href="#appendix-1">Appendix 1: S Parameter Basics</a>
    <ol>
      <li><a href="#polar-display">Polar Display</a></li>
      <li><a href="#rectangular-display">Rectangular Display</a></li>
      <li><a href="#group-delay">Group Delay</a></li>
      <li><a href="#swr">SWR</a></li>
    </ol>
  </li>
  <li><a href="#appendix-2">Appendix 2: Calibration Details</a>
    <ol>
      <li><a href="#detector-calibration">Detector Calibration</a></li>
      <li><a href="#s21-compensation">S21 Compensation</a></li>
      <li><a href="#s11-compensation">S11 Compensation</a></li>
      <li><a href="#fixture-calibration-data-set">Fixture Calibration Data Set</a></li>
    </ol>
  </li>
  <li>
    <p><a href="#appendix-3">Appendix 3: Software Installation, Registry</a></p>
  </li>
  <li><a href="#appendix-4">Appendix 4: Group Delay and Aperture</a>
    <ol>
      <li><a href="#aperture-shortening">Aperture Shortening</a></li>
    </ol>
  </li>
</ol>

<h2 id="overview">Overview</h2>

<p>This manual provides instructions for using
TAPR Network Analyzer (VNA) software with nanoVNA.
Due care is required in test setup, calibration,
and operational methods to fully realize nanoVNA accuracy.
This manual applies to nanoVNA firmware release 0.2.3.</p>

If you are not already familiar with
<ul>
  <li>S-parameters</li>
  <li>forward and reflected magnitude, gain and phase</li>
  <li>polar and rectangular plots
</ul>
... consider reading <strong>Appendix 1 Overview of S Parameters</strong> before continuing here.

<p>A VNA performs measurements on one-port or two-port networks.<br>
A two-port network has input and output (plus ground(s)).<br>
A one-port network has only an input (and ground).
Network input is connected to nanoVNA CH0 (TX) connector,
and network output is connected to nanoVNA CH1 (RX) connector.</p>

<p>This VNA is capable of four measurements:</p>

<ul>
  <li>
    <p><font color="green">S21</font> Magnitude - gain or loss from two-port network input to output.</p>
  </li>
  <li>
    <p><font color="blue">S21</font> Phase - transfer phase from two-port network input to output.</p>
  </li>
  <li>
    <p><font color="red">S11</font> Magnitude - return from network input port
referenced to the signal sent to that port.</p>
  </li>
  <li>
    <p><font color="AA00AA">S11</font> Phase - the phase angle of return from network input
port referenced to the signal sent to that network.</p>
  </li>
</ul>

<p>Other measurements are derived from these four.</p>

<div style="page-break-after: always;"></div>

<h2 id="hardware-version-differences">Hardware Version Differences</h2>

<p>See <a href="https://oristopo.github.io/nVhelp/html/hardware.htm">nanoVNA hardware</a></p>

<h2 id="instrument-caution">Instrument Caution</h2>

<p>The nanoVNA places about a -10 dBm level signal (~0.1 milliwatts)
onto the CH0 connector during measurements.</p>

<h2 id="temperature-limitation">Temperature Limitation</h2>

<p>Overclocked nanoVNA Si5351 is somewhat temperature sensitive.
For best performance, allow nanoVNA to warm for 10 minutes before
calibrating or measuring, but also avoid overheating.
Key nanoVNA temperature dependence is stimulus performance approaching 300/900 MHz.</p>

<p>To begin, connect nanoVNA to host by USB cable, turn it on, then launch the TAPR program.</p>

<h2 id="basic-performance">Basic Performance</h2>
<ul>
  <li>Power 120mA USB-C</li>
  <li>USB type CDC (virtual COM port) serial console</li>
  <li>Frequency Range 50kHz - 900MHz</li>
  <li>Frequency Tolerance / Stability (ppm) &lt; 2.5 / &lt; 0.5</li>
  <li>Measurement Range 70dB (&lt;300MHz), 50dB (&lt;600MHz), 40dB</li>
  <li>Scan points 101 max</li>
  <li>Port SWR &lt; 1.1</li>
  <li>Display 2/4 traces, 4 markers, 5 stored configurations</li>
</ul>

<h2 id="relative-measurements">Relative Measurements</h2>

<p>nanoVNA measures neither signal magnitudes nor phase delays absolutely.
All measurements are calculated relative to other measurements. In most
cases, this other measurement will be an instrument or fixture
calibration. Measurement accuracies thus directly
depend on reference calibrations.</p>

<p>Return measurements are extremely sensitive to fixture configurations.
Great care must be used making <font color="red">S11</font> measurements to obtain
reasonably accurate data. For example, a single 50-ohm
connector adaptor less than 1 inch long introduces measurable
phase delay in return signals. Properly set up,
nanoVNA can resolve connector adaptor lengths.  Practically,
calibrations should include connector adaptors as used in
actual measurements.</p>

<div style="page-break-after: always;"></div>

<h2 id="instrument-limitations">Instrument Limitations</h2>

<ul>
  <li>
    <p>VNA S21 dynamic range is limited by the receiver noise figure (mostly cross-talk).
S11 dynamic range is limited by bridge directivity,
then stimulus harmonics power and mixer response above 300MHz.</p>
  </li>
  <li>
    <p>VNA basic resolution is 0.1 dB for amplitude measurements.
Phase measurement resolution is 1 degree.</p>
  </li>
  <li>
    <p>The group delay measurement simply differentiates successive phase
measurements. Consequently, groupd delay calculations will be wrong
if phase changes more than 180 degrees between successive measurement points.</p>
  </li>
  <li>
    <p>The smallest frequency measurement interval is 1 hertz. Thus the
span width (STOP Frequency - START Frequency) must be at least as
great as the 101 points in the frequency grid.
For example, the START frequency
should be at least 101 Hertz greater than the STOP frequency.</p>
  </li>
  <li>
    <p>nanoVNA CH1 return loss is about 15 dB.
If measurement results critically depend upon a more accurate
termination, be sure to use a highly accurate attenuator of
at least 10 dB between the device under test (DUT)
and the CH1 connector. The VNA fixture calibration
can do the math for you automatically
(run a fixture calibration 'through' with the attenuator in place).</p>
  </li>
  <li>
    <p>Frequency source accuracy is determined by an on-board 26 MHz crystal oscillator,</p>
  </li>
  <li>
    <p>The default frequency range on instrument startup is 50 KHz to 900
MHz. The instrument is capable of operating higher, but
accuracy is degraded above 300 MHz.</p>
  </li>
  <li>
    <p>The phase detectors are accurate only down to about <font color="0086A6">20 dB</font> above the
noise floor. Thus, the phase component of an <font color="green">S21</font> measurement with
more than about <font color="0086A6">60 dB</font> attenuation is not valid. The phase component
of <font color="red">S11</font> measurements is only valid to about <font color="0086A6">40 dB</font> return loss.</p>
  </li>
</ul>


<div style="page-break-after: always;"></div>

<h2 id="calibration-standards">Calibration Standards</h2>

<p>Some high quality commercial attenuators are not exactly 50.0 ohms in
impedance. A resistance error of 0.5 ohms in the "50 ohm terminated"
calibration step is enough to degrade return loss dynamic range.
Similarly, quality of SHORTs and OPENs used in fixture
calibration can degrade calibrations. This is one reason nanoVNA
uses SMA rather than BNC connectors for
CH1 and CH0 ports -- these connectors cause less
discontinuity than other types.</p>

<p>Proper calibration needs:</p>
<ul>
  <li>a high-quality SHORT with minimal excess inductance,</li>
  <li>a high quality OPEN with minimal excess capacitance, and</li>
  <li>a high-quality 50-ohm termination with known delay</li>
</ul>

<p>Details:</p>
<ul>
  <li>
    <p>A high-quality SHORT normally consists of a screw-on connector shell
that shorts the center pin to the outside shell with minimal excess
inductance. These are manufactured commercially. Alternatively, an
SMA receptacle with a small disk (with a hole drilled in the
center), fit over the center pin, and soldered between the pin and
connector flange on the rear side minimizes excess
inductance and thus makes an acceptable SHORT. Either can be easily
attached to an SMA cable using an SMA barrel connector.</p>
  </li>
  <li>
    <p>A high-quality OPEN consists of a connector with minimized length of
center conductor projecting beyond the shell insulator.
An open SMA connector at the end of a cable provides an adequate
OPEN circuit for calibration steps because SMA
connector designs provides this feature. A special SMA open provides
best termination, but an open connector is adequate for many
purposes.</p>
  </li>
  <li>
    <p>A <font color="0086A6">40 dB</font> attenuator is needed when running the detector calibration
routine (described in section 3); a high-quality, accurate
attenuator (or a combination of 2 SMA attenuators) should be used
for this purpose.</p>
  </li>
  <li>
    <p>One-meter and three-meter cables are needed for detector calibration
(although exact cable lengths are not critical).</p>
  </li>
</ul>

<h2 id="calibration-modes-are-single-threaded">Calibration Modes are Single-threaded</h2>

<p>This TAPR software is multi-threaded, meaning that other Windows
programs can run while this software acquires data in the background.
However both fixture and instrument calibration are single-threaded
code. This means that these two calibrations routines will stall if
another Windows program has the <em>focus</em>, and will
continue when the TAPR application regains focus. The progressbar may
take awhile to update after the TAPR program regains focus.</p>

<div style="page-break-after: always;"></div>

<h1 id="software-installation">Software Installation</h1>

<h2 id="initial-software-installation">Initial Software installation</h2>

<p>Install TAPR software <a href="https://github.com/erikkaashoek/Tapr-VNA/raw/master/VNAR4.4.zip">GitHub</a>.
TAPR requires Microsoft Windows© dotNET 1.1 run-time,
but other applications and Microsoft service packs
may have it already installed it.</p>

<ul>
  <li>
    <p>Double-click on the downloaded <font color="0086A6">VNAR4.4.zip</font>,<br>
 which should open to reveal <font color="0086A6">VNAR4.4.exe</font>.<br>
If that fails, the zip file was probably corrupted during download.</p>
  </li>
  <li>
    <p>Launch <font color="0086A6">VNAR4.4.exe</font><br>
<img src="splash.gif" alt=""></p>
  </li>
  <li>If alerted that dotNET 1.1 runtime is not found:
    <ul>
      <li>Install Microsoft's dotNET 1.1 framework from their website.<br>
          It is referred to as a <b>Redistributable Package</b>.<br>
	   Its URL at the time of this manual revision is:<br>
<a href="https://www.microsoft.com/en-us/download/details.aspx?id=26">https://www.microsoft.com/en-us/download/details.aspx?id=26</a>
    </ul>
  </li>
</ul>

<h3 id="hibernation-or-suspension-of-host-computer">Hibernation or Suspension of Host Computer</h3>

<p>If the host computer (typically a laptop) hibernates or suspends,
exit TAPR, then restart.</p>

<div style="page-break-after: always;"></div>

<h2 id="supported-windows-versions">Supported Windows Versions</h2>

<p>While VNAR4.3 software may run on Windows operating systems as shown,
nanoVNA support is expected for no older than Windows 7:</p>

<table><tbody><tr>
<th>Windows</th><th>Support</th><th>Notes</th>
</tr><tr>
<td> Windows 98 -- Gold</td><td>Maybe</td><td>Supports only USB 1.0, not 1.1</td>
</tr><tr>
<td>Windows 98 SE<br>(Second Edition)</td><td>Yes</td><td>Tested</td>
</tr><tr>
<td>Windows ME</td><td>Probably</td><td>Not tested</td>
</tr><tr>
<td>Windows NT</td><td>Probably</td><td>Not tested</td>
</tr><tr>
<td>Windows 2000</td><td>Yes</td><td>Tested</td>
</tr><tr>
<td>Windows XP</td><td>Yes</td><td>Tested</td>
</tr><tr>
<td>Windows 7</td><td>nanoVNA</td><td>Tested?</td>
</tr><tr>
<td>Windows 8.1</td><td>nanoVNA</td><td>Tested</td>
</tr><tr>
<td>Windows 10</td><td>nanoVNA</td><td>Tested</td>
</tr></tbody></table>

<h2 id="software-distribution">Software Distribution</h2>

<p>The current software distribution consists of:</p>
<table>
<tbody><tr><th>Filename</th><th>Function</th></tr>
<tr><td>VNAR4.4.zip</td><td>Installer ZIP file</td></tr>
</tbody></table>

<h2 id="installed-tapr-files">Installed TAPR Files</h2>

<p><font color="0086A6">VNAR4.4.zip</font> includes only <font color="0086A6">VNAR4.4.exe</font>;  file locations can change...</p>

<table>
<tbody><tr><th>File name</th><th>Where found</th><th>Function</th></tr>
<tr><td>VNAR4.4.exe</td><td>Inside VNAR4.4.zip</td><td>Host program</td></tr>
<tr><td>Help.chm</td><td><a href="https://github.com/erikkaashoek/Tapr-VNA/raw/master/VNAR3%20Help.chm">GitHub</a><br>Should be in folder with VNAR4.4.exe</td><td>Compiled help file</td></tr>
</tbody></table>

<h2 id="installation-pre-requisites">Installation Pre-Requisites</h2>

<p>VNAR4 software expects a reasonably current <a href="#initial-software-installation">Windows
.NET 1.1 framework run time package</a> (version 1.0 is not sufficient).<br>
A virtual COM port driver is required for nanoVNA; see <a href="#appendix-3">Appendix 3</a> for details.
<div style="page-break-after: always;"></div>

<h2 id="connecting-nanovna-to-your-computer">Connecting nanoVNA to your Computer</h2>

<p>After verifying TAPR program launch, <b><i>quit</i></b> it.<br>
Connect nanoVNA to your computer using a USB cable and power on.
This may provoke Windows "New Hardware Detected Wizard".r
The wizard finds nanoVNA device and attempts to associate a device driver.
When prompted, let the wizard search to find the driver
(since it may have been installed for STM DFU utility).</p>

<p>After Windows has installed a driver and with nanoVNA connected and powered on, relaunch VNAR4.<br>
If launched before nanoVNA connection, VNAR4 may not detect it.</p>
Select 'SerialPort' under 'Settings" and confirm that 'Hardware:' is set to 'NanoVNA'.<br>
<p align="center"><img src= "SerialPort.gif"></p>

Once connected to VNAR4, nanoVNA display no longer updates for stimulus or RF connection changes.<br>
Display changes will reflect data scanned prior to VNAR4 control.

<h2 id="uninstall">Uninstall</h2>

<p>To uninstall this TAPR VNA application, simply delete VNAR4 .exe and .zip files.
See <a href="#appendix-3">Appendix 3</a> for details.</p>

<div style="page-break-after: always;"></div>

<h1 id="fixture-calibration">Fixture Calibration</h1>

<p>Test fixtures (test setups) consist of connectors, cables, adaptors
and other things that affect <font color="green">S21</font>
and <font color="red">S11</font> measurements.
Test fixtures have different physical properties.
For example, each interconnecting test cable length
affects the phase of all measurements (due to propagation time
delays specific to each cable). Therefore, each test setup
requires unique calibration data to compensate for test setup
and errors internal to nanoVNA.
 TAPR software supports "fixture calibrations",<br>
and you make one unique for each measurement set up,
saved with descriptive file names,
to later identify each fixture exactly!</p>

<p>Before starting Fixture calibration, have available<br>
'SHORT', 'OPEN', '50-ohm TERMINATION', and a connector bullet (or barrel).
'OPEN' is just the open end of an SMA cable with nothing connected.</p>
<p align=center>
<img src="Cal.gif" alt="Calibration window">
</p>
<div style="page-break-after: always;"></div>

<h2 id="fixture-calibration-data">Fixture Calibration Data</h2>

<p>Fixture calibration data sets are built from four raw data
measurements - 'Open', 'Short', 'Terminated', and 'Through'.</p>

<p>The following procedure makes a typical calibration data set:</p>
<ol>
<li>  The cable from nanoVNA CH0 connector to the device under test
    (DUT) is disconnected <em>at the DUT</em>, then terminated by a sequence
    of precision loads:
<ol compact>
 <li><code>'Short' calibration with a zero-ohm load terminating the CH0 cable</code>

 <li><code>'Open' calibration with unterminated CH0 cable</code>

 <li><code> 'Terminated' calibration with CH0 cable terminated by 50-ohm load</code>

<li><code>"Through" calibration is performed with
    connector barrel or bullet (usually a double-female connector
    adaptor) connecting CH0 and CH1 cables</code>
</ol>

<li>Error compensation parameters are computed, and the data set is
    saved with a descriptive filename using the extension <font color="0086A6">.cal</font>.</p>

<p>The Fixture Calibration dialog box lists the 4 individual steps needed
to perform calibration. <font color="green">A green
check mark</font> appears next to each completed step. Follow steps in order,
connecting SHORT, (OPEN,) TERMINATION, and THROUGH as
described for each step before clicking that step.
After completing all steps, with all check marks present, click the 'SAVE' button.</p>

<p>Interconnecting cables and connectors are left in place because all contribute
measurement error; calibration removes both any time delay and
amplitude changes they cause.</p>

<p>The calibration routine makes 1024 measurements evenly spaced from 200 KHz
to 120 MHz, spaced
about 117 KHz apart. The test fixture itself
(without the DUT) is assumed to not have any high-Q resonances, which would
introduc large uncertainties into measurements (whether or
not calibrated). The DUT may of course have high-Q resonances, but
NOT fixturing or interconnecting cables. When applying
calibration, software linearly interpolates between corrections for those two
calibration frequencies nearest actual measurement frequencies,
to compensate measurements.</p>

<p>"Open," "Short," or "50-ohm" inaccuracies confound
measurement compensation. At 100 MHz, nanoVNA is fairly
sensitive to load inaccuracies.</p>

<p>Normally, many different calibration data sets are eventually
taken and stored, one for each test setup. These can have any valid
windows filename, and descriptive filename are helpful,
but the extension is always <font color="0086A6">.cal</font>.
The "Apply Fixture Calibration" checkbox is <font color="gray">grayed-out</font>
until a valid Fixture Calibration Data set is loaded.</p>

<div style="page-break-after: always;"></div>

<h2 id="partial-changes-to-fixture-calibration-data">Partial Changes to Fixture Calibration Data</h2>

<p>It's possible to partially update the Fixture calibration data.
For example, changing the cable from a DUT to nanoVNA CH1
connector may not appreciably affect <font color="red">S11</font> measurement, but
generally changes <font color="green">S21</font> measurement.
In this case, load a previously saved calibration dataset
and run just the one measurement ('Through') ,
then save the dataset with new or existing name as appropriate.
The newly saved data set inherits
<font color="red">S11</font> raw and derived errors from the loaded dataset,
but uses the new 'through' measurements. In fact, this can be done for any or
all four measurements.</p>

<h2 id="fixture-setup-diagrams">Fixture Setup Diagrams</h2>

<p>The following three diagrams show fixture setup
during fixture calibration process and during actual
measurements using it. The following dialog box shows four
steps needed for fixture calibration. Diagrams in this section
show connections required to perform individual calibration
steps.</p>

<h2 id="actual-measurement">Actual measurement</h2>

<p>The cables, connectors, and adaptors connecting both CH0 and
CH1 connectors to the DUT are part of the test fixture. These
same cables connectors and adaptors must be left in place
during Fixture calibration steps, while the DUT itself is removed
and replaced with various loads and connector barrels during
Fixture Calibration steps.</p>

<p><img src="image4.png" alt=""></p>

<div style="page-break-after: always;"></div>

<h2 id="fixture-calibration-setups">Fixture Calibration Setups</h2>

<p>Only the cables, connectors, and adaptors connecting CH0 to
the calibration loads are part of the text fixture during the first
three fixture calibration steps. The fourth step also uses the cables,
connectors, and adaptors in the CH1 connection as well in order to
complete the fixture calibration. Typically all cables,
connectors, and adaptors are left in place, and only the DUT is
removed during Fixture Calibration steps.</p>

<p>Once all four steps are completed, click the "Save Cal Results..."
button to choose a file name and location. Use descriptive filenames,
as many different fixture calibration files are likely.</p>

<p>Filenames can be long and may contain embedded spaces. The
software automatically appends <font color="0086A6">.cal</font> to names.
Filenames are not limited to 8.3 format, which is insufficiently descriptive.</p>

<p><img src="image5.png" alt=""></p>

<h2 id="short-fixture-calibration">Short Fixture Calibration</h2>

<p><img src="image6.png" alt=""></p>

<div style="page-break-after: always;"></div>

<h2 id="open-fixture-calibration">Open Fixture Calibration</h2>

<p><img src="image7.png" alt=""></p>

<h2 id="50-ohm-terminated-fixture-calibration">50-ohm Terminated Fixture Calibration</h2>

<p><img src="image8.png" alt=""></p>

<h2 id="through-fixture-calibration">Through Fixture Calibration</h2>

<p>Cables, connectors, and adaptors connecting both CH0 and
CH1 connectors to the DUT are part of the test fixture.
Additionally, the bullet connector is part of the calibration test
fixture even though not present in actual measurements.
This represents a source of uncompensated error. Thus that connector
bullet must be short, low loss and impedance-matched to cables in
order to minimize errors.</p>

<p><img src="image9.png" alt=""></p>

<div style="page-break-after: always;"></div>

<h1 id="tapr-software-menu">TAPR Software Menu</h1>

<p>The following menu items are available in the TAPR program. Each menu
item is explained in the following sections.</p>

<p>File</p>

<p>View</p>

<p>Print</p>

<p>Print Setup Print Preview Set Plot title</p>

<p>Store Forward Parameters Store Reverse Parameters Export S-parameters</p>

<p>Rectangular Format Polar Format</p>

<p>Save Configuration ... Load Configuration ... Exit</p>

<p>Rectangular Polar</p>

<p>Time Domain Reflection</p>

<p>Calibration</p>

<p>Detector Calibration Run Fixture Calibration</p>

<p>Load Fixture Calibration File</p>

<p>Trace</p>

<p><font color="red">S11</font> Magnitude (rectangular) <font color="AA00AA">S11</font> Phase (rectangular) <font color="green">S21</font> Magnitude
(rectangular) <font color="blue">S21</font> Phase (rectangular)</p>

<p><font color="green">S21</font> Group Delay (rectangular)</p>

<p><font color="FF0044">S11</font> Magnitude as SWR (rectangular)</p>

<p>Raw Calibration Data <font color="green">S21</font> - Through (rectangular) Et - Tracking Error
(Polar)</p>

<p>Es - Source Mismatch Error (Polar) Ed - Directivity Error (Polar)</p>

<p>Raw Calibration Data <font color="red">S11</font> - Short (polar) Raw Calibration Data <font color="red">S11</font> -
Open (polar)</p>

<p>Raw Calibration Data <font color="red">S11</font> - Terminated (polar)</p>

<p>Vertical Scale</p>

<p>10 dB / division 5 dB / division 2 dB / division <font color="0086A6">1 dB / division</font></p>

<p>SWR 1.0 to 11.0</p>

<p>SWR 1.0 to 6.0</p>

<p>SWR 1.0 to 3.0 <font color="0086A6">SWR 1.0 to 2.0</font></p>

<p>10 microseconds / division 1 microsecond / division 100 nanoseconds /
division 10 nanoseconds / division 1 nanosecond / division
<font color="0086A6">100 picoseconds / division</font> Group Delay Aperture = 1 Group
Delay Aperture = 4 Group Delay Aperture = 16
<font color="0086A6">Group Delay Aperture = 64</font> Right Scale display</p>

<p>Phase SWR</p>

<p>Delay Polar Zoom</p>

<p>Zoom = 1.0</p>

<p>Zoom = 1.5</p>

<p>Zoom = 2.0</p>

<p>Zoom = 2.5 TDR Setup</p>

<p>Marker</p>

<p>Change Marker Frequencies Clear All Markers</p>

<p>Marker Numbers</p>

<p>Enable Disable</p>

<p>Marker Parameters Enable Disable</p>

<p>FreqGrid</p>

<p>100 points</p>

<p>200 points</p>

<p>400 points</p>

<p>1020 points Storage</p>

<p>Store Recall</p>

<p>Display Storage</p>

<p>Help</p>

<p>Display Help About</p>

<p>Launch Browser (to check for Software Updates)</p>

<div style="page-break-after: always;"></div>

<h2 id="file-menu">File Menu</h2>

<p>Use File to print measurements in graphical format
and store S-parameters in text files.</p>

<p>Print - selected view (rectangular or polar)</p>

<p>Print Preview - preview printed page format</p>

<p>Print Setup - select printer and set parameters</p>

<p>Set Plot Title - set / clear text appearing beneath plots</p>

<p>Store Forward Parameters - store measured reflection and
transmission data as <font color="red">S11</font> and <font color="green">S21</font> to temporary storage</p>

<p>Store Reverse Parameters - store measured reflection and
transmission data as S22 and S12 to temporary storage</p>

<p>Export S-Parameters - exports stored data in text format
Rectangular Format - S-parameters Real and Imaginary components normalized to 50 ohms</p>

<p>Polar Format - Magnitude in dB and Phase in degrees of S-parameters normalized to 50 ohms</p>

<p>Save Configuration - Saves to file complete instrument
settings and display trace state (except stored S-parameters).
The filename can be selected and should be very descriptive.</p>

<p>Load Configuration - Load a previously saved configuration file to
restore instrument state from a previous measurement setup.</p>

<p>Exit - immediately terminate the TAPR application (and save the
current instrument configuration to: <font color="0086A6">last.cfg</font>.</p>

<div style="page-break-after: always;"></div>

<h3 id="exporting-s-parameters">Exporting S-Parameters</h3>

<p>The VNA is a reflection-transmission test set. It measures
half of an S-parameter data set (<font color="red">S11</font> and
<font color="green">S21</font> in the forward direction) at one time.
Physically reverse the DUT in the test setup to measure the other half
(<font color="0086A6">S12</font> and
<font color="red">S22</font> in the reverse direction).</p>

<p>To measure and export a complete 4 parameter set:</p>

<ul>
  <li>
    <p>First set the frequency sweep (start and stop frequencies), and
apply calibration as desired.</p>
  </li>
  <li>
    <p>Make a measurement sweep in the forward direction</p>
  </li>
  <li>
    <p>Store Forward Parameters.</p>
  </li>
  <li>
    <p>Next, physically reverse the DUT (exchange input and output).</p>
  </li>
  <li>
    <p>Make a measurement sweep in the reverse direction without changing
the frequency sweep or calibration-applied boxes.</p>
  </li>
  <li>
    <p>Store Reverse Parameters</p>
  </li>
  <li>
    <p>After these two datasets have been stored, you may Export the S-
Parameters in either the Rectangular or Polar formats to a text
file.</p>
  </li>
</ul>

<p>Both the forward and reverse storage arrays are locked once stored;
this prevents accidental over-write. The menu items appear with a
checkmark when</p>

<p>locked. The only way to unlock them is to Export the file. Both
forward and reverse arrays must be filled before the Export function
can work.</p>

<div style="page-break-after: always;"></div>

<h2 id="view-menu">View Menu</h2>

Use View to select the display view:<dl>
<dt><b>Rectangular</b>
<dd>can display <font color="red">S11</font> magnitude and phase, and <font color="green">S21</font>
magnitude, phase, and group delay. It can also show <font color="green">S21</font> ('Through')
calibration parameters. Magnitude is plotted as dB vs. frequency,
phase is plotted as degrees vs. frequency, and group delay is plotted
as time vs. frequency. The display units (dB/div, and seconds/div) can
be selected in the VertScale menu.</dd>

<dt><b>Polar</b>
<dd>can display <font color="red">S11</font> (reflection measurement) and the
calibration data associated with reflections measurements. The Polar
display does not show <font color="green">S21</font> measurements.</dd>

<dt><b>Time Domain Reflection</b>
<dd>(TDR) mode performs a reflection
measurement then converts from a frequency measurement into the real
part of the time domain response. It displays reflection response versus
time. It is useful for testing cables for faults. TDR markers
calculate distance from the reference plane to the point indicated
by the marker. TDR resolution is 4.1 nanoseconds, limiting
cable fault resolution to about 1.3 feet (or about 0.4 meters).
TDR mode ignores Start and Stop frequencies; it needs to setup
a custom grid.</dd>

<h2 id="calibration-menu">Calibration Menu</h2>

<p>The Calibration menu provides three options:</p>

<p>1)  Generate (and save) a Detector calibration data set.</p>

<p>The detector calibration data set is auto-loaded by the application if
it exists. It does not normally need to run except the first time the
instrument is used. Only one detector calibration file is needed.</p>

<p>2)  Run (Generate, load, and save) a fixture calibration data set.</p>

<p>A separate fixture calibration set is needed for each different test
fixture.</p>

<p>3)  Load a previously saved test fixture calibration data set by name.</p>

<p>The Detector calibration procedure is described in section 3. The
Fixture calibration procedure is described in section 4.</p>

<p><strong>Appendix 2 Calibration Details</strong> provides a more detailed
description of how the calibration routines work.</p>

<div style="page-break-after: always;"></div>

<h2 id="trace-menu">Trace Menu</h2>

<p>Use the Trace menu to select how measurements are displayed.

<h3><a href="#rectangular-display">Rectangular Display</a> Mode</h3>

<p><font color="green">S21</font> displays only on Rectangular display.<br>
<font color="red">S11</font> displays on both Rectangular and Polar displays.<br>
Traces supported by Rectangular display are:</p>
<table style="width:70%">
<tr>
<td style="width:35%">S11 Magnitude</td><td>Device Under Test (DUT) input return loss magnitude, in dB</td>
</tr><tr>
<td>S11 Phase</td><td>DUT input return loss phase angle, in degrees, from +180 to --180</td>
</tr><tr>
<td>S21 Magnitude</td><td>DUT forward transfer gain (or loss) magnitude, in dB</td>
</tr><tr>
<td>S21 Phase</td><td>DUT forward transfer phase, in degrees</td>
</tr><tr>
<td>S21 Group Delay</td><td>DUT forward transfer gain (or  loss) derived group delay</td>
</tr><tr>
<td>S11 Magnitude as SWR</td><td></td>
</tr><tr>
<td>S11 as R Ohms</td><td>S11 real value converted to Ohms</td>
</tr><tr>
<td>S11 as jX Ohms</td><td>S11 quadrature value converted to Ohms</td>
</tr></table>
<table style="width:70%">
<table><tr>
<td style="width:35%">Raw Calibration Data - S21thru</td>
<td>Raw data taken from the through VNA connection CH0 to CH1<br>
    (through cables actually connecting to the DUT)</td>
</tr></table>

<h3><a href="#polar-display">Polar Display</a> Mode</h3>

<p><font color="red">S11</font> (as a polar complex number) is always displayed on the Polar display.
<font color="green">S21</font> <em>cannot</em> be displayed on the polar display.
Raw calibration data (from a calibration file that is loaded)
as well as error parameters derived from calibration data can be displayed.<br>
Error compensation and raw data are only for informational purposes
and normally not displayed.</p>

<p>Traces that can be added to Polar mode display are <a href="#fixture-calibration-data-set">here</a></p>
<div style="page-break-after: always;"></div>

<h3 id="time-domain-reflection-mode">Time Domain Reflection Mode</h3>

<p>The TDR mode displays the real part of the Inverse Fast Fourier
Transform of a reflection measurement. Because the TDR mode requires a
specific custom frequency grid, it ignores the Start and Stop
settings. When switching to the TDR mode, a new Frequency Grid is
created. Thus, a new sweep is required. Click the sweep button. A
TDR interpretation of existing
<font color="red">S11</font> sweep data is not meaningful 
and should be ignored, instead re-acquire the
reflection measurement after you have selected the TDR mode. The
'Apply Calibration' checkbox sets the reference plane for the TDR
analysis. When the 'Apply Calibration' box is checked, distances
specified on the TDR display are with respect to the reference plane
(the end of the cable calibrated with the Short, Open, and Termination
loads).</p>

<p>The display Start time, display Stop time, and estimated velocity
factor of a cable under test are specified in the TDR Setup dialog,
reached from the Vertical Display menu. Additionally, distances from
the Reference Plane to the Marker point can be displayed in METERS or
FEET.</p>

<p>TDR mode resolution is limited by a VNA's maximum stimulus frequency.
It is possible to infer between TDR points by visually
interpolating. For example, if two consecutive TDR points have the
same large time reflection, the actual time position will lie in
between those two consecutive times.</p>

<h2 id="device-under-test">Device Under Test</h2>

<p>The reflection and forward measurements are made with respect to the
Device Under Test (DUT).<br>The reference plane location is established
when the fixture calibration is run and loaded.</p>

<div style="page-break-after: always;"></div>

<h2 id="vertical-scale-menu">Vertical Scale Menu</h2>

<p>Use Vertical Scale to independently select vertical
scale units per division for magnitude (in dB / division), maximum
SWR display (minimum is always 1.0), group delay (seconds per
division), and aperture size of the group delay computation.</p>

<p>Magnitude Display resolutions selections are:<br>
10 dB / div <font color="0086A6">5 dB / div</font> 2 dB / div <font color="0086A6">1 dB / div</font> 0.5 dB / div</p>

<p>SWR Scale selections are:<br>
SWR 1.0 to 11.0<br>
SWR 1.0 to 6.0<br>
SWR 1.0 to 3.0<br>
SWR 1.0 to 2.0</p>

<p>Impedance Scale selections are:<br>
1k Ohms / div<br>
100 Ohms / div<br>
10 Ohms / div</p>

<p>Right Scale Display selections are:<br>
Phase / SWR / Delay / Ohms<br>
[rectangular] Right Scale Display values adjust to selected vertical scale factors.</p>

<p>Polar Zoom Factor applies a zoom factor to polar displays.
The default value is 1.0, representing normal Smith Chart display,
with a reflection coefficient of 1.0 lying on the chart periphery.
Increasing zoom keeps the 50 + j0 point the centered 
and displays impedances near 50 + j0 with more resolution.
A zoom factor of 2.0 places reflection coefficient values of 0.5 on the chart periphery.
<br>There are four display zoom settings:<br>
Zoom = 1.0 / 1.5 / 2.0 / 2.5</p>

<p>Group Delay Time Scale selections are:<br>
1 millisecond / div   <br>
100 microsec / div   <br>
10 microsec / div <br>
1 microsec / div <br>
100 nanosec / div<br>
10 nanosec / div <br>
1 nanosec / div <br>
100 picosec / div</p>

<div style="page-break-after: always;"></div>

<p>Group Delay Aperture</p>
<ul>
  <li>the number of adjacent frequency bins over which group delay is measured. <br>
Group Delay Aperture = 1 / 4 / 16 / 64<br>
</ul>

<p>See <a href="#appendix-4">Appendix 4</a>
for details on how group delay is derived<br>and how data can be
smoothed (or distorted) by aperture size changes.</p>

<p>Note that small frequency spans significantly magnify group delay
measurement noise, due to small difference
frequencies between adjacent samples.
Larger aperture windows and grid point counts
reduce measurement noise for narrow sweeps. However, large
apertures may smooth data beyond the range of interest,
so carefully select an appropriate aperture size.</p>

<p>Use TDR Setup for</p>
<ul>
  <li>setting TDR Display Start and Stop times (in nanoseconds).
This enables zooming to areas of interest.</li>
  <li>entering an estimated cable velocity factor value,
which is used to calculate distances from the reference plane
to marker points (perhaps a cable fault).
The valid range is 0.4 to 0.99.</li>
  <li>selecting Meters or Feet for distance display<br>
<img src="TDR.gif" alt=""></li>
</ul>

<div style="page-break-after: always;"></div>

<h2 id="marker-menu">Marker Menu</h2>

<p>The Marker menu can set up to five marker frequencies and<br>
control display of associated parameters.</p>

<p>A marker value of 0 disables it.</p>

<h3 id="mouse-actions">Mouse Actions</h3>

<p>Mouse left and right buttons perform several different actions.</p>

<p>Clicking <strong>left mouse button</strong> in Rectangular
Display drops the first unused marker at the pointer frequency,
which marker can be dragged left and right until the left button is released.
Screen parameters update in real-time as markers are dragged.
Existing markers can be grabbed and dragged,
but it takes very precise aim and is pretty difficult to do in practice.
It's usually easier to launch the Marker menu, disable
that particular marker (by entering a value of zero) and then dropping
and dragging a new marker. Alternatively, markers can
be set coarsely by mouse, then adjusted precisely by menu.</p>

When all five are in use,
left-clicks do not create new markers but can drag exiting ones.

<p>Clicking <strong>Right mouse button</strong> pops up screen
coordinates and electrical parameters for the pointer location
(unrelated to traces).
This works in both rectangular and polar modes.
That popup remains until the pointer
moves some pixels, then disappears.</p>

<p>Rectangular display frequencies are readily apparent,
but not so much for Polar display. However, with marker
parameters enabled, marker frequency displays in Polar display mode
and updates in real time while being dragged.
Markers move opposite to mouse movements
when <font color="red">S11</font> trace is
in the lower (capacitive) Polar display half.</p>

<p>Vertical (up/down) mouse movements do not change marker frequency.<br>
Marker parameters are color-coded to match corresponding trace colors.<br>
Parametric values
<font color="red">S11</font>,
<font color="green">S21</font>, and
<font color="FF0088">SWR</font>
are displayed only if corresponding trace displays are enabled.</p>

<dl>
<dt>Change Marker Frequency
<dd>Allows setting any of the five marker frequencies.
<br>A marker set less than startFrequency or larger than stopFrequency is not displayed.

<dt>Clear All Markers
<dd>Sets all markers to zero, disabling their display.

<dt>Marker Numbers
<dd>Enable - displays the marker number above each marker.
<dd>Disable - turns off the marker number, showing just the markers.

<dt>Marker Parameters
<dd>Enable - displays the marker parametric value(s) underneath marker frequency.
<dd>Disable - turns off the marker parametric display.
</dl>

<div style="page-break-after: always;"></div>

<h2 id="frequency-grid-menu">Frequency Grid Menu</h2>

<p>Use FreqGrid to select Frequency Grid point count,
the number of measurements made from Start to Stop Frequency.
Allowed values are:</p>
<table>
<tbody><tr>
<td>100 Points</td><td>Coarsest frequency display, but fastest measurement data acquisition</td>
</tr><tr>
<td>200 Points</td><td></td>
</tr><tr>
<td>400 Points</td><td></td>
</tr><tr>
<td>1020 Points</td><td>Finest frequency display, but slowest measurement data acquisition</td>
</tr></tbody></table>

<p>The instrument defaults to 200 points at startup.<br>
More points increase display resolution,<br>
fewer points reduce measurement time period.<br>
Current FreqGrid setting also affects S-parameter text file exportation,<br>
which have FreqGrid individual frequency records.</p><p>
Calibration runs are fixed in size at 1024 frequency points.
Checking 'Apply Calibration' <br>interpolates
grid frequency points to nearest calibration frequency points,<br>
with nearest calibration point results applied to measurements.<br>
With calibration points about 117 KHz apart, nearest is closer than 59 KHz.<br>
Unless fixtures have resonances (which is very bad anyway),<br>
interpolation errors for any frequency grid size will be
negligible except for very long cables.</p>

<h2 id="storage-menu">Storage Menu</h2>

<p>Use Storage menu to store the current measurement set into
temporary memory. This temporary memory will retain that measurement
set until the program is terminated, or a new measurement set is
stored.<br>
Setting a new stored measurement over-writes existing measurements in storage.</p>

<p>Storage menu has three options:<br>
<dl>
<dt><b>Store</b>
<dd> captures the complete raw measurement set<br>
(whether or not the traces are displayed) and stores it to memory.

<dt><b>Recall</b>
<dd> retrieves the measurement set from memory and over-writes the
current active measurement set.<br>
It does not delete or alter the raw data in storage.

<div style="page-break-after: always;"></div>

<dt><b>Display Storage</b>
<dd>a toggle that is checked when storage contents are displayed.
</dl>

<p>A common use of the storage function is to make a measurement, verify
it's useful, then 'store' the data.<br>
Next, some change to the device under test is made and a new measurement is made.<br>
Use Display Storage to compare on-screen the two measurements.</p>

<p>Markers are only attached to the active display set. MARKERS ARE
NOT ATTACHED TO THE STORED DATA. This helps to distinguish which data
on screen are active and which are storage.
<br>To use markers on stored data,
retrieve that data to the active set using the <b>Recall</b> menu item.</p>

<h2 id="integration-menu">Integration Menu</h2>

<p>Use Integration for averaging together multiple nanoVNA sweeps.
1x mean no integration.
2x averages the previous and current sweep.
4x, 8x, and 16x use exponential integration to average results.
For example, at 16x, the display weights 15/16 of previous with 1/16 of
new value. The integrator is RESET for selection changes
and returns raw values from the next sweep.
Subsequent sweeps will integrate.
Changing the Frequency Grid size also resets the integrator.</p>

<p>Resetting the integrator prevents large offsets from taking long
times to clear integrated values and avoids waits to
see initial results from changes.</p>

<h2 id="help--software-updates">Help &amp; Software Updates</h2>

<p>The help menu launches the HTML Help viewer with the TAPR help menu.</p>

<p>The About command opens an 'about TAPR' menu. This menu displays the
current build number of the software</p>

<p>It also contains a button to launch your Internet Browser with the
address of the TAPR software update website. This will display a
page showing the current TAPR software available. You can
compare your build number with the latest build available number shown
on the web page. Be sure to REFRESH your web browser display.<br>
If you wish, you may download the update from here (right-click, and Save as ...)</p>

<p>Exit the TAPR application before installing updates.</p>

<div style="page-break-after: always;"></div>

<h1 id="controls">Controls</h1>

<p>TAPR window controls change start &amp; stop frequencies, reference &amp; transmit signal levels, and sweep functions.
<img src="TAPR.gif" alt=""><br>
 Those controls are not shown on printed outputs.</p>

<h2 id="frequency-controls">Frequency Controls</h2>

<p>Frequency controls set sweep START and STOP frequencies.
Arrows increment or decrement frequencies. Controls can be
set to specific values by double-clicking, which opens
numeric entry dialog boxes for directly typing in desired frequencies.</p>

<p>START and STOP controls display underscore characters
beneath a digit. This digit will be
incremented or decremented by up or down arrows. Left and
right arrows change selected digit position.
Controls will increment neither above 120,000,000 Hz, nor below 200,000
Hz.</p>

<p>A STOP frequency must be greater than START frequency by the
frequency grid size. For exampe, if grid size is 400 points,
then STOP must be at least 400 Hertz greater than START.</p>

<h2 id="apply-calibration">Apply Calibration</h2>

<p>The apply calibration check box is <font color="gray">grayed-out</font> unless a fixture
calibration data set has been loaded (see calibration menu). Checking
the Apply Calibration box will compensate all readings by the
corrections contained in the loaded fixture calibration set.
Un-checking the box disables the reading corrections.</p>

<p>Measurements without any fixture calibration are not accurate, since
there are uncompensated errors in cable length, fixture attenuation,
etc. Further, some VNA instrument errors such as PC board trace
lengths and amplitude variations are not removed if the measurement is
uncalibrated. For best accuracy, measurements should have fixture
calibration applied.</p>

<div style="page-break-after: always;"></div>

<h2 id="level-controls">Level Controls</h2>

<p>Reference Level adjusts how magnitude data are
displayed on screen. The control value specifies
the magnitude level at the top line of the display screen. When
set to 0 dB, the display top line is 0 dB. Changing
Reference Level optimizes trace locations.</p>

<p>For example, if a DUT attenuates approximately <font color="0086A6">22 dB</font>,
that will not display at a scale of 1 dB / division,
because off the screen bottom. Reference Level set
to <font color="0086A6">-20 dB</font> displays a range from <font color="0086A6">-20 db</font>
to <font color="0086A6">-30 db</font> at 1 db/division, making the trace visible.</p>

<p>Reference Level set to positive values is useful when measuring DUTs (such as amplifiers) with output
magnitudes near or above <font color="0086A6">0 dB</font>.<br>
Note that VNA dynamic range extends only a few dB above <font color="0086A6">0 dB</font>.<br>
<em>External attenuators should be used with DUTs having any amount of gain.</em></p>

<p>On-screen amplitude values displayed left-side
automatically adjust when reference
levels change. Small positive reference levels help make visible
markers and marker numbers when measuring low-loss DUTs.</p>

<p>Transmit Level should normally be left at 0 dBm.
Lower values usually degrade dynamic
range and accuracy of both <font color="red">S11</font> and <font color="green">S21</font> measurements.
However, reduced drive level to DUTs with gain may be useful.
The control has about 50 dB of adjustment range, but nanoVNA dynamic range
consumes 40 dB of that range. Thus, <font color="green">S21</font> magnitude measurements
effectively support less than <font color="0086A6">10 dB</font> of level change.
Attenuating CH0 stimulation to DUTs using attenuators is better.
</p>

<p>Magnitude values displayed automatically track changes in
Transmit Level. By the way, one valid use for the Transmit Level
control is to adjust output level when using the VNA as a
signal generator and measured values are of no concern.
In this case, the control can change transmit output
signal level over a 10 dB range.</p>

<div style="page-break-after: always;"></div>

<h2 id="sweep-controls">Sweep Controls</h2>

<p>There are three buttons on the screen that control how the TAPR
acquires data. These three buttons are:</p>

<ul>
  <li> Sweep Speed
  <li> Single Sweep
  <li> Free-run Sweep
</ul>

<p>The Sweep Speed button determines the sweep dwell time for each
measured sample, and if nanoVNA data are checked for measurement
glitches. If set to the Fast mode, the VNA sweeps as fast a possible,
and does not check the reading data for measurement glitches. As the
button is successively clicked, the sweep speed will be set to the
following values:</p>
<ul>
  <li>30 microseconds</li>
  <li>100 microseconds</li>
  <li>300 microseconds</li>
  <li>1 millisecond</li>
  <li>3 milliseconds</li>
  <li>10 milliseconds</li>
</ul>

<p>The button recycles back to Fast after the 10 ms step. When the button
displays any time value (but not Fast), more extensive comparison of
the measured data is used to try and reject obviously defective
individual data points (not always successfully). In the Fast mode
these checks are bypassed, sometimes resulting in momentary glitches
in the measured data. However, the Fast mode sweeps much than any of
the timed modes.</p>

<p>The single sweep mode triggers nanoVNA one time, and holds the
measured data after that single sweep.</p>

<p>The Free-run sweep button causes the VNA to trigger continuously
(recurrently), so that the sweep updates as rapidly as possible.
Pressing the Free-run sweep button a second time stops the recurrent
sweeping. The frequency grid button is <font color="gray">grayed-out</font> when the VNA is
sweeping, since the number of points cannot be changed during a sweep.</p>

<p>One very useful setup is to use a small frequency grid, for example
100 or 200 points, fast sweep mode, and recurrent sweep. This speeds
display updates and may be particularly useful when
tuning a DUT such as a filter or antenna in real-time.</p>

<div style="page-break-after: always;"></div>

<div style="page-break-after: always;"></div>

<h1 id="example-measurement">Example Measurement</h1>

<p>The following general steps are used to measure a device under test,</p>

<ol>
  <li>
    <p>Make sure that detector calibration has been run<br>
(you do not get a warning message on program startup).</p>
  </li>
  <li>
    <p>Connect cables and adapters from the device under test (DUT) to nanoVNA.</p>
  </li>
  <li>
    <p>Either run a Fixture calibration on these cables and adaptors, or
load a previously saved fixture calibration for these exact same
cables and adaptors.</p>
  </li>
  <li>
    <p>Remove any shorts, or through connector barrels, and replace with
the DUT connected from CH1 to CH0.</p>
  </li>
  <li>
    <p>Run a sweep of the DUT.</p>
  </li>
  <li>
    <p>Enable the Fixture Calibration checkbox on screen. This checkbox can
be selected or deselected at any time (before or after the sweep).</p>
  </li>
</ol>

<p>Let's look at an example DUT, a low pass filter. A single sweep of
data captures all the data points shown in the following three screen
shots. The different screen shots are just different views of the
single data set.</p>

<p><img src="image10.jpeg" alt=""></p>

<p>This screen shows GREEN - the <font color="green">S21</font> transfer magnitude (forward
gain/loss). The screen in set for 10 dB / division. RED is the <font color="red">S11</font>
return loss of the filter, again at 10 dB / division. The filter has
about <font color="0086A6">60 dB</font> loss at 50 MHz, degrading a bit at 100 MHz. The return
loss of the filter is about 10-15 dB in the filter passband (200 KHZ
to 40 MHZ) and is <font color="0086A6">0 dB</font> in the stopband (above 40 MHz).</p>

<p>This type of filter is called a <em>"reflective filter"</em> since it
generates a stopband by reflecting the input signal back.</p>

<p>On the next screen, the <font color="red">S11</font> (RED) trace has been turned off and only
the <font color="green">S21</font> (GREEN) trace is displayed. Five markers have been set, and
the display of marker parameters has been enabled. Here we can see
that the insertion loss of the filter is quite good, only about <font color="0086A6">0.1 dB</font>
in the passband, and that the <font color="0086A6">-3 dB</font> frequency is about 39.85 MHz.</p>

<p><img src="image11.jpeg" alt=""></p>

<p>The last figure shows input return <font color="red">S11</font> on a polar chart.
Four markers (which must be set in the rectangular display mode) are
selected, and marker parameter display is again enabled. The markers
show the input magnitude and phase as well as the equivalent input
impedance of the filter at each marker frequency. The filter spirals
outwards from the origin, but stays between the SWR=1.5 and SWR=2.0
concentric bull's eyes until it reaches the stopband frequency, when
it rapidly spirals out of the center toward the periphery of the
chart. The light gray concentric SWR circles on the polar chart are:</p>
<ul>
  <li>SWR = 1.5 (Innermost)</li>
  <li>SWR = 2.0</li>
  <li>SWR = 3.0</li>
  <li>SWR = 5.0</li>
  <li>SWR = 10.0 (Outermost)</li>
</ul>

<div style="page-break-after: always;"></div>

<p>Due to small ripple errors in the directional coupler, the stopband
return loss is calculated as negative a few tenths of a dB (which is
wrong). This is shown at marker 4. The polar chart is very non-linear
and changes in return loss of tenth's of a dB cause the distance from
the center of the chart to change a lot when the return loss is near
zero dB, but these changes are minimal when the return loss is more
than a few dB.</p>

<p>TAPR software currently compensates for frequency dependent errors.
Starting with version 1.4 the software models the coupler V/I tracking
error and coupler directivity.<br>
 It compensates readings by subtracting
the coupler directivity and applying a sinusoidal magnitude correction
vs. detected phase angle to <font color="red">S11</font> readings.</p>

<p><img src="image12.jpeg" alt=""></p>

<p>By the way, these plots are of a high-quality Bencher YA-1 low-pass-filter designed for HF amateur radio.</p>

<p><a href="https://github.com/erikkaashoek/Tapr-VNA/tree/master/Doc/Measurement%20examples">Other example measurements</a></p>

<div style="page-break-after: always;"></div>

<h2 id="some-cautions">Some Cautions</h2>

<ul>
  <li>
    <p>High quality variable attenuators may have several tenths of a dB
loss at their <font color="0086A6">0 dB</font> setting. This must be taken into
account when characterizing filter insertion loss.</p>
  </li>
  <li>
    <p>Attenuator resistance may not be exactly 50.0 ohms. This
will degrade 50-ohm calibration.</p>
  </li>
  <li>
    <p>Attenuators have finite length. Thus an attenuator inserted
(or removed) after fixture calibration impacts phase angles of the
setup from the Fixture correction because the distance to the 'SHORT'
and 'OPEN' used for fixture calibration has changed.</p>
  </li>
  <li>
    <p>VNA CH1 connector input impedance is only approximately 50 ohms.
When measuring returns of networks with minimal attenuation,
phase and amplitude components may include errors due to
this CH1 connector deviation from an ideal 50 ohm load.
To improve the measurement either:</p>

    <ul>
      <li>
        <p>Terminate the unit under test with a 50 ohm termination prior to
<font color="red">S11</font> measurements, or</p>
      </li>
      <li>
        <p>Insert 10 dB attenuation between DUT output and VNA CH1 connector.
This will assure that the DUT sees more accurate 50 ohm termination
impedance.</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="common-display-results">Common Display Results</h2>

<p>Some common measurements will result in the displays shown in this
section. These can be used to verify that you have correctly
calibrated and setup the VNA and the test cables. These results are
typical, but you may realize slight differences depending on the
cables, instrument measurement errors, etc.</p>

<p>Also, there may be minor variations between consecutive instrument
sweeps due to measurement variation or other artifacts. These sweeps
were performed in the 'Slow' mode.</p>

<div style="page-break-after: always;"></div>

<ul>
  <li>Shorted cable - with and without cable calibration. The following
charts show the polar and rectangular displays of a shorted cable on
the CH0 connector. The fixture calibration was performed with
the same cable and short as the measurement, so the fixture and
amplitude compensation should match (excepting sweep-by-sweep
measurement errors, instrument temperature change, etc.).</li>
</ul>

<p><img src="image13.png" alt=""><br>
<em>3 meter cable terminated in 'Short' <font color="0086A6">without</font> fixture calibration applied.</em></p>

<p><img src="image14.png" alt=""><br>
<em>3 meter cable terminated in 'Short' <font color="0086A6">with</font> fixture calibration applied.</em></p>

<div style="page-break-after: always;"></div>

<ul>
  <li>Open cable - with and without cable calibration. The following
charts show the polar and rectangular displays of an open cable on
the CH0 connector. The fixture calibration was performed with
the same cable as the measurement, so the fixture and amplitude
compensation should match (excepting sweep-by-sweep measurement
errors, instrument temperature change, etc.).</li>
</ul>

<p><img src="image15.png" alt=""><br>
<em>3 meter cable terminated in ''Open' <font color="0086A6">without</font> fixture calibration applied.</em></p>

<p><img src="image16.png" alt=""><br>
<em>3 meter cable terminated in ''Open' <font color="0086A6">with</font> fixture calibration applied.</em></p>

<div style="page-break-after: always;"></div>

<ul>
  <li>Terminated cable - with and without cable calibration. The
following charts show the polar and rectangular displays of a
reasonable quality 1 meter 50-ohm cable terminated with a 50-ohm
load on the CH0 connector. The fixture calibration was
performed with the same cable and termination as the measurement, so
the fixture and amplitude compensation should match (excepting
sweep-by-sweep measurement errors, instrument temperature change,
etc.).
</li>
</ul>

<p><img src="image17.png" alt=""><br>
<em>1 meter cable terminated in 50-ohm load <font color="0086A6">without</font> fixture calibration applied.<br>
Polar scale is zoomed 2.5:1 to show more details.</em></p>

<p><img src="image18.png" alt=""><br>
<em>1 meter cable terminated in 50-ohm load <font color="0086A6">with</font> fixture calibration applied. <br>
Polar scale is zoomed 2.5:1 to show more details.</em></p>

<div style="page-break-after: always;"></div>

 <strong>Note</strong>: many cables and adapters connected to nanoVNA
may exhibit much poorer return loss than shown here.

<p><img src="image19.png" alt=""><br>
<em>Rectangular display of <font color="red">S11</font> for 1 meter cable terminated by 50-ohm load <font color="0086A6">without</font> fixture calibration applied.</em></p>

<p><img src="image20.png" alt=""><br>
<em>Rectangular display of <font color="red">S11</font> for 1 meter cable terminated by 50-ohm load <font color="0086A6">with</font> fixture calibration applied.</em></p>

<div style="page-break-after: always;"></div>

<h1 id="appendix-1">Appendix 1: S Parameter Basics</h1>

<p>This overview briefly covers reflection and transmission
measurements using S-parameters, and visualization of them on
rectangular and polar displays.</p>

<p>A linear two port device can be characterized by the behavior of the
voltage returned to voltage injected at the ports. The S-parameter
model provides all the linear characteristics of a two port device at
discrete spot frequencies. S- parameters describe input return,
forward gain, reverse gain, and output return each as a
complex number at a single frequency. For each discrete frequency,
these 4 values describe the behavior of the two port device. To
characterize a device, the S-parameters are usually measured at a
number of different frequencies.</p>

<p>In the diagram below, <b>a1</b> in the voltage input to port one, and <b>a2</b> is
the voltage input to port two; <b>b1</b> is the voltage out of port one,
while <b>b2</b> is the voltage out of port two. S-parameters are defined
as voltage ratios. <font color="red">S11</font> (input return) is the ratio
<b>b1/a1</b>. <font color="green">S21</font> (transfer gain) is the ratio of <b>b2/a1</b>. The voltage
exiting port one of the block is the sum of the input return loss times
the input voltage plus the reverse gain times the voltage injected
into port two of the block.
S-parameters are defined in the following two equations:</p>

<h4>b1 = a1 * S11 + a2 * S12</h4>
<h4>b2 = a1 * S21 + a2 * S22</h4>

<p><img src="Sparam.gif" alt=""></p>

<p>A VNA is really a transmission-reflection test set.
It applies stimulus <b>a1</b> to port one of the device while
measuring <b>b1</b> and <b>b2</b>, then calculates <font color="red">S11</font>
(because <b>a2</b> is zero).</p>

<ul>
  <li>port 2 of the block receives no stimulus (<b>a2</b> = 0).
To derive values for <font color="green">S12</font> and <font color="red">S22</font>,
swap ports in the test fixture
so that VNA stimulus becomes <b>a2</b>.</li>
</ul>

<p><font color="red">S11</font> and <font color="green">S21</font> are generally both complex numbers - in other words,
devices reflect energy back to the input for any spot frequency
with reflection magnitude and phase both generally non-zero.
Similarly, two-port devices typically change both amplitude
and phase of <b>b2</b> from <b>a1</b>.
The VNA measures and displays input reflection loss
and forward transmission gain as complex numbers.</p>

<div style="page-break-after: always;"></div>

<h2 id="polar-display">Polar Display</h2>

<p>
Polar chart help visualize input impedance real and reactive components.
Since reflection ratios <font color="red">S11</font> are always <= 1.0
for passive networks, those values can be displayed in imaginary vs real format on a polar charts.
On the other hand, two port network forward gains typically include both loss and gain values,
exceeding unity. That confounds polar charts, where
polar chart circumference typically represents unity magnitude.
Note that polar charts have no concept of frequency;
<font color="red">S11</font> samples for any spot frequency may display anywhere on polar charts.
VNAR4 software connects sample dots in lines;
subsequently extracting frequency information along those lines wants <a href="#"marker-menu">markers</a>.
</p>

<p><font color="red">S11</font> polar values are directly plotted,
with <font color="red">S11</font> vectors originating at chart center,
vector lengths being return loss magnitudes, and
vector directions being <font color="red">S11</font> phase angles.
The chart left side corresponds to +/-180 degrees and lower impedances,
while the right side corresponds to 0 degrees and higher impedances.</p>

<h2 id="rectangular-display">Rectangular Display</h2>

<p>Rectangular display works for both <font color="red">S11</font> and
<font color="green">S21</font> values.
Return loss amplitudes are simply displayed vs. frequency,
but sorting complex impedance gets harder. 
Two-port networks' transfer complex impedances are less
interesting than their gains and phase delays vs. frequency.
Rectangular chart help visualize those
<font color="green">S21</font> parameters.</p>

<p>Network transfer gain/loss amplitude is labelled in dB on rectangular charts' right side.
Return loss or transfer gain phase is plotted in degrees vs. Hertz.
Rectangular chart top and bottom are +180 and -180 degrees, respectively,
'wrapping around' from bottom to top because +/-180 degrees are identical.
Rectangular chart top and bottom <b><i>both</i></b> represent 180 degrees.</p>

<p>
Phase values varying slightly above and below 180.0 degrees
provoke confusing rectangular displays, since
what might nominally be nearly straight traces can
instead varying wildly up and down,
alternately near top and bottom lines.</p>

<div style="page-break-after: always;"></div>

<h2 id="group-delay">Group Delay</h2>

<p>Network time delays are of interest.
Network group delay is the negative of rate of change of phase vs frequency
and helps determine network electrical length for cables or stubs.</p>

<p>Group delay and spatial length measurement determine velocity factor.
Cable phase velocity is elapsed time for light traveling a cable length
divided by cable's electrical time delay.
Light travels 11.8 inches per nanosecond (nearly 1 nanosecond per foot).
10 feet of free space delays light 120/11.8 ~ 10.17 nanoseconds.
The velocity factor for 10 feet of cable with 15 nanoseconds electrical delay is:</p>

<p><font color="0086A6">10.17 nsec</font> (free space delay) /
<font color="0086A6">15 nsec</font> (measured delay) =  0.68 velocity factor.

<div style="page-break-after: always;"></div>

<h2 id="swr">SWR</h2>

<p>Network SWR at any specific frequency describes of how
nearly that network input matches a 50 ohm non-reactive load when
that network's output is terminated in 50 ohms. An SWR of 1.0 means
that the network has exactly 50-ohm input impedance. SWR is a real number directly
related to input return <em>magnitude</em>, ignoring input reflection phase.
<font color="red">S11</font> is a complex number representing both magnitude and
phase angle of input return.</p>

<p>An SWR of 2.0 means that an input impedance is either 25 ohms resistive, 100 ohms resistive,
or some complex value with either of those magnitudes containing non-zero reactance.
SWR cannot distinguish among those networks cases for non-unity values,
while <font color="red">S11</font> can.</p>

<p>Each constant SWR value describes any impedance
lying on a circle centered in polar charts.
The polar chart center is 50+j0 ohms, with SWR of 1.0 (its circle is a point).
All other SWR values are pointless.
Higher SWR values correspond to circles of increasing radius centered on the chart,
with the circle at polar chart periphery representing infinite SWR.</p>

<p>This table relates SWR to input return loss magnitude:</p>

<table> <tbody><tr>
<th> SWR </th><th> Return Loss (dB)</th>
</tr><tr>
<td>1.00 </td><td> infinite</td>
</tr><tr>
<td>1.03 </td><td>36.60</td>
</tr><tr>
<td>1.05 </td><td>32.25</td>
</tr><tr>
<td>1.10 </td><td>26.45</td>
</tr><tr>
<td>1.15 </td><td>23.12</td>
</tr><tr>
<td>1.20 </td><td>20.83</td>
</tr><tr>
<td>1.30 </td><td>17.70</td>
</tr><tr>
<td>1.40 </td><td>15.56</td>
</tr><tr>
<td>1.50 </td><td>13.98</td>
</tr><tr>
<td>1.60 </td><td>12.74</td>
</tr><tr>
<td>1.70 </td><td>11.73</td>
</tr><tr>
<td>1.80 </td><td>10.88</td>
</tr><tr>
<td>1.90 </td><td>10.16</td>
</tr><tr>
<td>2.00 </td><td>9.54</td>
</tr><tr>
<td>2.50 </td><td>7.36</td>
</tr><tr>
<td>3.0</td><td>6.02</td>
</tr><tr>
<td>4.0</td><td>4.44</td>
</tr><tr>
<td>5.0</td><td>3.52</td>
</tr><tr>
<td>10.0</td><td>1.74</td>
</tr><tr>
<td>20.0</td><td>0.87</td>
</tr><tr>
<td> infinite </td><td>0.00</td>
</tr>
</tbody></table>

<div style="page-break-after: always;"></div>

<h1 id="appendix-2">Appendix 2: Calibration Details</h1>

<h2 id="detector-calibration">Detector Calibration</h2>

<p>Detector calibration applies a range of signals from
approximately 0 dBm down to -90 dBm to each magnitude detector
(transmission and reflection) repeatedly over the range
200 KHz to 120 MHz. Calibration software models each detector
response function (voltage vs. level) at each frequency. The model
consists of linear and noise floor portions. Software
models the linear portion by generating a linear least-squares
regression estimator for amplitude measurements and a correlation
coefficient. It then generates an empirical exponential noise floor estimator
that fits a smooth curve for a complete linear + noise floor response.</p>

<p>The detector calibration routine similarly characterizes both phase
detectors. Phase calibration is a bit more complex than
amplitude calibration. It uses a fixed length of cable and
varies frequency to develop linear frequency-dependent phase
excitation to the detectors.
It then finds phase detector voltage levels corresponding to - 180, 0, and
+180 degrees (the positive peak, midpoint, and negative peak voltages
respectively). Phase detectors have periodic error components,
and the detector calibration routine uses a linear delay model to
build a table to correct those periodic errors.</p>

<p>All those data sets are then saved in
<font color="0086A6">detector.ica</font> in the TAPR program startup directory.</p>

<h2 id="s21-compensation">S21 Compensation</h2>

<p>Fixture calibration measures received signals through a
small bullet or barrel connector. It measures received magnitude
and phase at 1024 points from 200 KHz to 120 MHZ and
stores those data in a table in the Fixture calibration file (which
is named during the Fixture calibration save operation).
When the 'Apply Calibration' box is enabled,
the calibration compensation routine divides actual <font color="green">S21</font> measurements
by the nearest 'Through' calibration constant (which is a complex number)
at each measurement frequency.
</p>

<div style="page-break-after: always;"></div>

<h2 id="s11-compensation">S11 Compensation</h2>

<p>The calibration compensation for <font color="red">S11</font> derives three parameters of a
virtual S- parameter error matrix computationally inserted between the
VNA CH0 connector and the DUT. With three measurements and three
unknowns, values of virtual S-parameter error matrix can be resolved.
These three parameters are:</p>

<p>Et - the tracking error. This is (S21error * S12error) product of
the virtual error matrix.</p>

<p>Ed - the directivity error. This is S11error of the virtual error
matrix.</p>

<p>Es - source impedance mismatch. This is the S22error of the virtual
error matrix.</p>

<p>The virtual error matrix is removed from <font color="red">S11</font> measurements (when
'Apply Calibration' is active) to compensate for these errors in
reflection measurements.</p>

<h2 id="fixture-calibration-data-set">Fixture Calibration Data Set</h2>

<p>Fixture calibration data sets include the following.<br>
Values can be viewed (by the curious) from the <a href="#polar-display-mode">Trace menu</a>.<br>
Polar display is only for reflection measurements (S11)
and related raw and derived calibration constants.<br>
Rectangular display can show both <font color="red">S11</font> and
<font color="green">S21</font> measurements and related calibration constants.</p>

<table style="width:70%">
<tr><th style="width:30%">Error Compensation</th><th>Complex plot</th></tr>
<tr>
<td>Et - Tracking</td>
<td>amplitude and phase<br>for cable from nanoVNA CH0 to the DUT</td>
</tr><tr>
<td>Es - Source Mismatch</td><td>error from imperfect source impedance termination</td>
</tr><tr>
<td>Ed - Directivity</td><td>due to finite bridge directivity</td>
</tr></table>
<table style="width:70%">
<tr><th style="width:30%">Raw Calibration Data</th><th>Data source during calibration<br>(or loaded from a calibration file)</th>
</tr><tr>
<td>S11short</td><td>shorted CH0 during calibration</td>
</tr><tr>
<td>S11open</td><td>unterminated CH0</td>
</tr><tr>
<td>S11term</td><td>CH0 terminated by "known" 50-ohm load</td>
</tr>
</table>

<div style="page-break-after: always;"></div>

<h1 id="appendix-3">Appendix 3: Software Installation, Registry</h1>

<p>
This TAPR VNA application should work with the same driver as other nanoVNA software.<br>
When you first apply power to nanoVNA and attach it to a Windows PC
via its USB cable, its USB device ID may not be found.
The New Hardware Detected wizard will be invoked and will ask if a disk or
file is available for the new device.
<em>recommended</em> option presented). The correct device type is:</p>

<p><a href="https://www.st.com/en/development-tools/stsw-stm32102.html">STMicroelectronics Virtual COM Port Driver</a></p>



<p>The wizard creates a registry key associating that USB vendor
and product ID to a device driver.<br>
When this USB device is subsequently plugged into that USB host port,
it avoids going through the selection process again.</p>

<p>nanoVNA uses the following USB IDs: Vendor_ID: 0483 Product_ID: 5740</p>

<p>The Wizard makes a registry entry in order to associate
the device with the driver needed to communicate with it (usbser.sys).
This registry can be removed (but need not be removed)
if TAPR software is uninstalled.
Registry keys are normally left in place, but if for some reason you
want, it can be deleted using Regedit.</p>

<p>Different versions of windows have different Registry directory
structures, and the keys are placed in different locations.</p>

<ul>
  <li>You can delete the Registry key associated with this particular USB
device (VID 0483, PID 5740),<br>
in which case the next time it is plugged in, the new hardware detected wizard will run.</li>
</ul>

<table>
<tbody><tr>
<th>Version</th><th>Registry Key Location</th>
</tr><tr>
<td>Win98, ME</td><td>\HKEY_LOCAL_MACHINE\Enum\USB</td>
</tr><tr>
<td>Win NT, 2000, XP</td><td>\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\USB</td>
</tr></tbody></table>

<div style="page-break-after: always;"></div>

<h1 id="appendix-4">Appendix 4: Group Delay and Aperture</h1>

<p>Group Delay is an equivalent time delay through a device or network.<br>
Mathematically, it is defined at the negative of the rate of change
(the slope) of phase φ vs. frequency ω:</p>

<p><em>GroupDelay</em> = - <em>d</em>φ / <em>d</em>ω</p>

<p>In a VNA, a measurement sweep consists of a number of individual
discrete data points taken at single spot frequencies. Group
delay is calculated by looking at two adjacent frequency samples -
current sample<sub>n</sub> and next sample<sub>n+1</sub>, being taken at
frequencies f<sub>n</sub> and f<sub>n+1</sub>. The difference in phase is calculated by
subtracting the phase reading taken at frequency f<sub>n</sub> from the phase
reading taken at frequency f<sub>n+1</sub>. The delay is then calculated by
converting degrees into radians and the sign is changed.
Unfortunately, this finite difference process can result in large
amounts of noise in readings, due to small errors in measured
phase, or from actual noise in measurements.</p>

<p>One way to reduce displayed noise is to average group
delay readings over more samples. This delay reading is less
noisy, but it may miss some important rapid changes in phase
response. TAPR allows selecting the sample averaging
count. The count of samples averaged is known as
measurement <em>aperture</em> size.</p>

<p>An aperture size of 1 disables averaging, and
measurements are taken between adjacent frequency samples. The
aperture frequency window is thus f<sub>n+1</sub> - f<sub>n</sub>.</p>

<p>An aperture size of 64 means that delays are calculated by
subtracting the phase measured at frequency sample f<sub>n+32</sub> from the
phase measured at frequency sample f<sub>n-32</sub>. Thus the reading spans 64
frequency differences (65 samples). One drawback to this averaging
technique is that the phase could change through several 360 degree
rotations between f<sub>n-32</sub> and f<sub>n+32</sub>. This would result in a group
delay calculation being far less than the real group delay since the
VNA cannot resolve phase changes exceeding 360 degrees. Thus aperture
should be used with appropriate caution.</p>

<div style="page-break-after: always;"></div>

<h2 id="aperture-shortening">Aperture Shortening</h2>

<p>TAPR software's aperture window concept has
difficulty for samples near limit (start and stop) frequencies.
Lacking samples below a first measurement at start frequency f<sub>n</sub>,
TAPR lacks phase value samples for frequencies < f<sub>n</sub>.
For aperture windows of 64, software <em>shortens</em> effective aperture windows
by using f<sub>n</sub> to f<sub>n+32</sub> (rather than f<sub>n-32</sub> to f<sub>n+32</sub>).
Effective apertures are thus 32 (not 64) and skewed.
The same shortening and skew happens at stop frequencies (no samples for > f<sub>n</sub>).</p>

<p>Software similarly shortens aperture windows for
samples nearer than half aperture windows to limit frequencies,
by a lesser amount for each sample farther from limits. Once the
32<sup>nd</sup> frequency sample distant from a limit frequency is reached,
all samples necessary for 64-point apertures are present,
and aperture windows are no longer shortened.</p>

<p>For aperture sizes of 4 and 16, worst case shortening is to
effective aperture sizes of 2 and 8 samples, respectively,
near limit frequencies.</p>
      
</font>
</body></html>
